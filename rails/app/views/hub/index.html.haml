%h1
  - if @tag.present?
    = bi_icon('tag') + @tag
  - elsif @user.present?
    - if @user.use_avatar?
      = avatar_image(@user, size: 30,
        style: 'vertical-align: top; margin-top: 0.25em; margin-right: 0.1em;') + @user.name
    - else
      = bi_icon('person-fill') + @user.name
  - else
    = @default_title

  = render 'templates_switch', show_templates: @show_templates

%p.small
  = @explanation_text

- thing_key = { 'Site' => :site, 'Template' => :template }[@thing_name] || :site
- count = @sites.respond_to?(:total_count) ? @sites.total_count : (@sites.size rescue 0)

%p.text-muted{ style: 'font-size: 95%' }
  - if @tag.present?
    - if thing_key == :site
      - if count == 1
        = t('hub_view.tagged_with.site.one')
      - else
        = t('hub_view.tagged_with.site.other')
    - elsif thing_key == :template
      - if count == 1
        = t('hub_view.tagged_with.template.one')
      - else
        = t('hub_view.tagged_with.template.other')
    %b= @tag + '.'
  - elsif @user.present?
    - if thing_key == :site
      = t('hub_view.created_by.site')
    - elsif thing_key == :template
      = t('hub_view.created_by.template')
    %b= @user.username + '.'

%div{ style: "margin-bottom: 2em;" }
  %ul.nav.nav-tabs
    - if thing_key == :site
      = hub_link_to(t('hub_view.nav.all_sites'), hub_all_url)
    - elsif thing_key == :template
      = hub_link_to(t('hub_view.nav.all_templates'), hub_all_url)
    - @tag_tabs.each do |tag|
      = hub_tag_link_to(tag, crawler_protect: true)

.page_info.text-muted
  = page_entries_info(@sites, model: @thing_name)
  - if @tag.present?
    = t('hub_view.suffix.tagged_with')
  %b= @tag
  - if search_text.present?
    = t('hub_view.suffix.matching')
  %b= "#{search_text}"

  %span.sort-by
    = link_to("#", class: 'dropdown-toggle',
      role: 'button', 'data-bs-toggle': 'dropdown', 'aria-haspopup': 'true', 'aria-expanded': 'false') do
      %span.pe-1
        = t('hub_view_list_kind') + ':'
      - if @kind_filter.present? && @kind_filter != "all"
        = logo_for_kind(@kind_filter, "margin-left: 2px; height: 1.3em; margin-top: -3px;")
      - else
        = t('hub_view_list_show_all')
    .dropdown-menu.hub-menu{ 'aria-labelledby': 'dropdownMenuLink' }
      = filter_link(:k, nil, crawler_protect: true)
      - filter_params[:k].keys.each do |k|
        = filter_link(:k, k, crawler_protect: true) do |_, title|
          = logo_for_kind(k, "margin-right: 4px; height: 1.3em;")
          = title

  %span.sort-by
    = link_to("#", class: 'dropdown-toggle',
      role: 'button', 'data-bs-toggle': 'dropdown', 'aria-haspopup': 'true', 'aria-expanded': 'false') do
      %span.pe-1
        = t('hub_view_list_sort_by') + ':'
      = sort_opt[:title]
    .dropdown-menu.hub-menu{ 'aria-labelledby': 'dropdownMenuLink' }
      - sort_options.keys.each do |k|
        = simple_sort_link k, 'dropdown-item', crawler_protect: true

  = render 'search_box'

.hub{ class: ("clone-button-on-hover" unless @show_templates) }
  - @sites.each do |site|
    = render 'site_tile', site: site, mode: 'hub'

= will_paginate(@sites)
